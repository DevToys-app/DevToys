<Project>
  <Import Project="$([MSBuild]::GetPathOfFileAbove('Directory.Build.targets', '$(MSBuildThisFileDirectory)../'))" />

  <Target Name="ImportPluginOnBuild" BeforeTargets="Run" AfterTargets="Build">
    <Message Text="Importing plugins..." Importance="high" />
    <ItemGroup>
      <PluginNupkgFiles Include="$(PluginNupkgPath)\*.nupkg" />
    </ItemGroup>
    <Unzip
      SourceFiles="@(PluginNupkgFiles)"
      DestinationFolder="$(PluginsInstallationFolder)\$([System.String]::Copy('%(Filename)').Split('.')[0]).$([System.String]::Copy('%(Filename)').Split('.')[1])"
      SkipUnchangedFiles="true"
      OverwriteReadOnlyFiles="true"/>
    <Message Text="Plugins imported!" Importance="high" />
  </Target>

  <Target Name="ImportPluginOnPublish" BeforeTargets="Publish">
    <Message Text="Importing plugins..." Importance="high" />
    <ItemGroup>
      <PluginNupkgFiles Include="$(PluginNupkgPath)\*.nupkg" />
    </ItemGroup>
    <Unzip
      SourceFiles="@(PluginNupkgFiles)"
      DestinationFolder="$(PluginsInstallationFolder)\$([System.String]::Copy('%(Filename)').Split('.')[0]).$([System.String]::Copy('%(Filename)').Split('.')[1])"
      SkipUnchangedFiles="true"
      OverwriteReadOnlyFiles="true"/>
    <Message Text="Plugins imported!" Importance="high" />
  </Target>
</Project>