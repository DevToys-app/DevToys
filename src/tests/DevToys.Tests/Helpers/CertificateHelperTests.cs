using System;
using DevToys.Helpers;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace DevToys.Tests.Helpers
{
    [TestClass]
    public class CertificateHelperTests
    {
        [DataTestMethod]
        [DataRow(PemCertPublic, null, true, CertDecoded)]
        [DataRow(PemCertWithPrivateKey, null, true, CertDecoded)]
        [DataRow(PfxNoPassword, null, true, CertDecoded)]
        [DataRow(PfxWithPassword, "test1234", true, CertDecoded)]
        public void DecodeCertificateSuccess(string input, string password, bool successfullyDecoded, string expectedResult)
            => DecodeCertificate(input, password, successfullyDecoded, expectedResult);

        [DataTestMethod]
        public void DecodeCertificateErrors()
        {
            // Cannot populate these vars via DataRow because https://learn.microsoft.com/en-us/dotnet/csharp/misc/cs0182?f1url=%3FappId%3Droslyn%26k%3Dk(CS0182)
            DecodeCertificate(PfxWithPassword, "wrong password!", true, LanguageManager.Instance.CertificateEncoderDecoder.InvalidPasswordError);
            DecodeCertificate(CertificateRequest, null, true, LanguageManager.Instance.CertificateEncoderDecoder.UnsupportedFormatError);
        }

        private void DecodeCertificate(string input, string password, bool successfullyDecoded, string expectedResult)
        {
            // Convert date output to UTC so that tests pass on any machine with any timezone
            var notBefore = DateTime.Parse("4/17/2023 10:40:48 AM");
            var notAfter = DateTime.Parse("4/16/2024 10:40:48 AM");
            var easternZone = TimeZoneInfo.FindSystemTimeZoneById("Eastern Standard Time");
            DateTime notBeforeUtc = TimeZoneInfo.ConvertTimeToUtc(notBefore, easternZone);
            DateTime notAfterUtc = TimeZoneInfo.ConvertTimeToUtc(notAfter, easternZone);

            bool result = CertificateHelper.TryDecodeCertificate(input, password, out string decoded);
            decoded = decoded.Replace(notBefore.ToString(), notBeforeUtc.ToString());
            decoded = decoded.Replace(notAfter.ToString(), notAfterUtc.ToString());
            Assert.AreEqual(result, successfullyDecoded);
            Assert.AreEqual(expectedResult, decoded);
        }

        /// <summary>
        /// These certificates can be created via
        /// PEM:
        /// openssl req -new -newkey rsa:4096 -nodes -keyout test-devtoys.key -out test-devtoys.csr
        /// openssl x509 -req -sha256 -days 365 -in test-devtoys.csr -signkey test-devtoys.key -out test-devtoys.pem
        /// 
        /// PFX:
        /// openssl pkcs12 -inkey test-devtoys.key -in test-devtoys.pem -export -out test-devtoys.pfx
        /// </summary>
        private const string PemCertPublic = @"-----BEGIN CERTIFICATE-----
MIIE8TCCAtkCFCfJ02eLyJUoeGzsBkJFSjlx5P8jMA0GCSqGSIb3DQEBCwUAMDUx
CzAJBgNVBAYTAkRUMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhEZXYg
VG95czAeFw0yMzA0MTcxNDQwNDhaFw0yNDA0MTYxNDQwNDhaMDUxCzAJBgNVBAYT
AkRUMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhEZXYgVG95czCCAiIw
DQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBANuTxLYIhWb87/zEdFIa0RhnZd6K
Tq+66yvpT82pN6REZ31bTf7xfNOeArSOWta80AfNCKVCw2UjCi2Qe0e+pNZU6Tjl
F5LKVnlW0XIT9BiRxxJ3TLAJpBiLeH/O0vikWx4Svlet7DrT3SW7S1CKxyAQF+DG
vEkH8dzqGyKzj1Yet6FOzY19DrNAcg+3yjm36bRYe24ykJ5wJ7g6v4TTwg4sW8bG
QDhvDmCMSlj4II7UCFj2w7uK0z1XBHvzsp0cBikQiUpTOvR3MZA4uzFevIPq/GWg
o4Hljp6qhVmYNC3dcjyLQjWyLYMIV3Wtqq2L+VbA6e4/wDw5dCB007RAAQp2dcLH
/5ybVZ4wZPM8Zsx52Stc4zygDKzrZZop4BhOip1UC1a9HAx39OrlF3B2Vi01VaNM
ztwvhbG4tZahZVKTbckkV9mAtx7c+xTAljx0uaz6fIzvnhziqBokxQQTLmyKAHXP
dPaomMa/Q5ruapBPfwIw9xgOCzyjDUn11fUO+W074F4V7YfN8aRdoxdasU4c/S3F
evJZqPsXgQAecETewXFdbX2DFTs8IR/Yz6UHeZaMjjl5g6lVALe/NFvmqp5sLm9T
ZM7haQG3hP9os/El6YXIK9Yyghf/5FdX3xbo8PpY1quoVuM0bgHQOs6M5JGRm02V
C3zNV0WDSHbVsGh1AgMBAAEwDQYJKoZIhvcNAQELBQADggIBAA+IHRcqvIzjPDGX
JSQQA/vadD2EmZDfY3HKTxvwXyRfn/9i0R0yKuMuZm9cgexVIHDHeark0PsvkJwh
Y7wXD5uNDq3kXPeHX3+xMLA6skBMYZT2lFBJrwUTGlNnJHBaJfBU+VvKNzDcMfRk
tp62PJyXP4qfcSGDDruaoqqmvzyaSyOdbsinQmWrxvd0Tio3JjQbD8dZNjc6E0Vl
aTQS7NggdBlt4Yp85k6VXEJFhVVwrJDrRftH7efp6ekT7MivrRQpEfb113gl2xuG
3JH2xQdFnmL3z5vSlS/ffkGdHUNZPib3CM1w/sG+9DrMK60CVWKVogF3YEg5pp9Q
OsdEabkiDPwZTDh9tm8cmfVckke7YzpPEw5mqJfsYa9MpwLVMsniCRNpfoZUoFNT
0kGu19K8+PVkNlhqOfzxaqHnjRIY5wytDY18JecSkmKlg8VSBZft7C3cxni27kxC
WWrZ6LI8sk0uO+NZPB/68Iz6Qf1VkSVgvDSN7aehpYQq3Gv73CQeJS9tyZ77RSqE
nqWDyI4+nwJNZN3VURGle1/5XOHNLlFnarVj2r9AGR3P5McwPocWm5Dw5rwf0pXf
psZA0Q7ZlBVnEArftIGFNa8UoUGR2Lo89gLJsDhqUkCVEy2zxD8FdrxZVdW1KtaT
ixUiDYhfU7a41ebpMlwMfA+QAuK0
-----END CERTIFICATE-----";

        private const string PemCertWithPrivateKey = @"-----BEGIN PRIVATE KEY-----
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
LVv3WFLNswm3oiS3VnDGaPnuwZZFpBI=
-----END PRIVATE KEY-----

-----BEGIN CERTIFICATE-----
MIIE8TCCAtkCFCfJ02eLyJUoeGzsBkJFSjlx5P8jMA0GCSqGSIb3DQEBCwUAMDUx
CzAJBgNVBAYTAkRUMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhEZXYg
VG95czAeFw0yMzA0MTcxNDQwNDhaFw0yNDA0MTYxNDQwNDhaMDUxCzAJBgNVBAYT
AkRUMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhEZXYgVG95czCCAiIw
DQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBANuTxLYIhWb87/zEdFIa0RhnZd6K
Tq+66yvpT82pN6REZ31bTf7xfNOeArSOWta80AfNCKVCw2UjCi2Qe0e+pNZU6Tjl
F5LKVnlW0XIT9BiRxxJ3TLAJpBiLeH/O0vikWx4Svlet7DrT3SW7S1CKxyAQF+DG
vEkH8dzqGyKzj1Yet6FOzY19DrNAcg+3yjm36bRYe24ykJ5wJ7g6v4TTwg4sW8bG
QDhvDmCMSlj4II7UCFj2w7uK0z1XBHvzsp0cBikQiUpTOvR3MZA4uzFevIPq/GWg
o4Hljp6qhVmYNC3dcjyLQjWyLYMIV3Wtqq2L+VbA6e4/wDw5dCB007RAAQp2dcLH
/5ybVZ4wZPM8Zsx52Stc4zygDKzrZZop4BhOip1UC1a9HAx39OrlF3B2Vi01VaNM
ztwvhbG4tZahZVKTbckkV9mAtx7c+xTAljx0uaz6fIzvnhziqBokxQQTLmyKAHXP
dPaomMa/Q5ruapBPfwIw9xgOCzyjDUn11fUO+W074F4V7YfN8aRdoxdasU4c/S3F
evJZqPsXgQAecETewXFdbX2DFTs8IR/Yz6UHeZaMjjl5g6lVALe/NFvmqp5sLm9T
ZM7haQG3hP9os/El6YXIK9Yyghf/5FdX3xbo8PpY1quoVuM0bgHQOs6M5JGRm02V
C3zNV0WDSHbVsGh1AgMBAAEwDQYJKoZIhvcNAQELBQADggIBAA+IHRcqvIzjPDGX
JSQQA/vadD2EmZDfY3HKTxvwXyRfn/9i0R0yKuMuZm9cgexVIHDHeark0PsvkJwh
Y7wXD5uNDq3kXPeHX3+xMLA6skBMYZT2lFBJrwUTGlNnJHBaJfBU+VvKNzDcMfRk
tp62PJyXP4qfcSGDDruaoqqmvzyaSyOdbsinQmWrxvd0Tio3JjQbD8dZNjc6E0Vl
aTQS7NggdBlt4Yp85k6VXEJFhVVwrJDrRftH7efp6ekT7MivrRQpEfb113gl2xuG
3JH2xQdFnmL3z5vSlS/ffkGdHUNZPib3CM1w/sG+9DrMK60CVWKVogF3YEg5pp9Q
OsdEabkiDPwZTDh9tm8cmfVckke7YzpPEw5mqJfsYa9MpwLVMsniCRNpfoZUoFNT
0kGu19K8+PVkNlhqOfzxaqHnjRIY5wytDY18JecSkmKlg8VSBZft7C3cxni27kxC
WWrZ6LI8sk0uO+NZPB/68Iz6Qf1VkSVgvDSN7aehpYQq3Gv73CQeJS9tyZ77RSqE
nqWDyI4+nwJNZN3VURGle1/5XOHNLlFnarVj2r9AGR3P5McwPocWm5Dw5rwf0pXf
psZA0Q7ZlBVnEArftIGFNa8UoUGR2Lo89gLJsDhqUkCVEy2zxD8FdrxZVdW1KtaT
ixUiDYhfU7a41ebpMlwMfA+QAuK0
-----END CERTIFICATE-----";

        private const string PfxNoPassword = "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";

        private const string PfxWithPassword = "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";

        private const string CertificateRequest = @"-----BEGIN CERTIFICATE REQUEST-----
MIIEejCCAmICAQAwNTELMAkGA1UEBhMCRFQxEzARBgNVBAgMClNvbWUtU3RhdGUx
ETAPBgNVBAoMCERldiBUb3lzMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKC
AgEA25PEtgiFZvzv/MR0UhrRGGdl3opOr7rrK+lPzak3pERnfVtN/vF8054CtI5a
1rzQB80IpULDZSMKLZB7R76k1lTpOOUXkspWeVbRchP0GJHHEndMsAmkGIt4f87S
+KRbHhK+V63sOtPdJbtLUIrHIBAX4Ma8SQfx3OobIrOPVh63oU7NjX0Os0ByD7fK
ObfptFh7bjKQnnAnuDq/hNPCDixbxsZAOG8OYIxKWPggjtQIWPbDu4rTPVcEe/Oy
nRwGKRCJSlM69HcxkDi7MV68g+r8ZaCjgeWOnqqFWZg0Ld1yPItCNbItgwhXda2q
rYv5VsDp7j/APDl0IHTTtEABCnZ1wsf/nJtVnjBk8zxmzHnZK1zjPKAMrOtlming
GE6KnVQLVr0cDHf06uUXcHZWLTVVo0zO3C+Fsbi1lqFlUpNtySRX2YC3Htz7FMCW
PHS5rPp8jO+eHOKoGiTFBBMubIoAdc909qiYxr9Dmu5qkE9/AjD3GA4LPKMNSfXV
9Q75bTvgXhXth83xpF2jF1qxThz9LcV68lmo+xeBAB5wRN7BcV1tfYMVOzwhH9jP
pQd5loyOOXmDqVUAt780W+aqnmwub1NkzuFpAbeE/2iz8SXphcgr1jKCF//kV1ff
Fujw+ljWq6hW4zRuAdA6zozkkZGbTZULfM1XRYNIdtWwaHUCAwEAAaAAMA0GCSqG
SIb3DQEBCwUAA4ICAQAiwhSDlLWBu3Yz1mMY5Bq8sZAy9V0vE6bl3RnoytLBczum
w/YSsUaI3BcJDPd+VoHd4clwlwQd5jcPh2iJmgW8qrH85PolUSACHgZklX4n8NI2
8o3JLO0o7JtvIns5z9useFqlp+hh9Y9IzZP2ydww6mxMzp0+olqhnnwIQERj6W76
43CsZhFTdOwqUEX7YDDzdtjKPfeLrN/QuQ3ZkZ+uOGPl+saqyCX/uqnzzypXDCpx
1+CoEhgxcd7HEZO/oT8PO8sZhwpr7x8fjZP3cUl42gegyAziai5mpDJ+duu4Jnkd
3yYN+rCFN0BSpvHJvC1ydVlntIt+yhIZe706OcFvXaIXSJku2PZpv7RFwn7+Fygo
WPKppbJVQGPw8/W6S4BJfw2mqkA4PItb7+NAC7xBEDaJ9JuxRkKoqaNbonZW8Vwy
YPuKozq1YEpCDNFdP0JWUCXboFm7gOAHdGiYBMSYtCqI62C3EhVBKXcyNXqL4URF
bldpOo9HJ/uYCU8wIfQxCMeZTdQOs1rX6CnXrSknz3jJqkytjn4b1ltWOtFzqs64
g41z4JMbh1zbm2xp2VoHTW9XAfr64/J5kJpf6EQcDkmEhb9Wz5PphjMgIEHfYCWb
dX+wpfqTJYWcw64txwyskqsxizFsZ4zTMObcHy6Q/puVlO9LtO4FW59Kd7YrAw==
-----END CERTIFICATE REQUEST-----";

        private const string CertDecoded = @"[Subject]
  O=Dev Toys, S=Some-State, C=DT

[Issuer]
  O=Dev Toys, S=Some-State, C=DT

[Serial Number]
  27C9D3678BC89528786CEC0642454A3971E4FF23

[Not Before]
  4/17/2023 2:40:48 PM

[Not After]
  4/16/2024 2:40:48 PM

[Thumbprint]
  9E5B55F43B571EFE82D386C856506FC96018217C";
    }
}
